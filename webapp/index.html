<!DOCTYPE html>
<html lang="ja-JP">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>WebNfcAttendance</title>

  <link href="./static/css/bootstrap.min.css" rel="stylesheet">
  <link href="./static/css/bootstrap-theme.min.css" rel="stylesheet">

  <link href="./static/css/local-style.css" rel="stylesheet">
</head>

<body>

  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Wna</a>
      </div>

      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li><a>Attendance</a>
          </li>
          <li><a>Member</a>
          </li>
          <li><a>Event</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row-12">
      <div class="col-sm-11 col-sm-offset-1 col-md-11 col-md-offset-1 main">
        <button type="button" class="btn btn-info" data-bind="click: addMember">Add</button>
        <table class="table">
          <thead>
            <tr data-bind="foreach: member_structure">
              <td data-bind="text: name">NoName</td>
            </tr>
          </thead>
          <tbody data-bind="foreach: { data: members, as: 'member'}">
            <tr data-bind="foreach: { data: $root.member_structure, as: 'structure'}">
              <td data-bind="text: member[structure.field]">No input</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>


  <!-- Modal -->
  <script type="text/html" id="EditMember">
    <div class="modal f\ade" tabindex="-1" role="dialog" aria-labelledby="EditMember" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">
              <span aria-hidden="true">&times;</span>
              <span class="sr-only">Close</span>
            </button>
            <h4 class="modal-title" id="EditMemberTitle">Member Edit</h4>
          </div>
          <div class="modal-body">
            <form class="form-horizontal" action="#" data-bind="submit: add">
              <div class="form-group">
                <label class="col-sm-2 control-label">Name:</label>
                <div class="col-sm-10 controls">
                  <input data-bind="value: name">
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">NfcId:</label>
                <div class="col-sm-10 controls">
                  <input data-bind="value: id">
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" data-bind="click: cancel">Close</button>
            <button type="button" class="btn btn-primary" data-bind="click: add">Save</button>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type='text/javascript' src="./static/js/jquery-2.1.0.js"></script>
  <script type='text/javascript' src="./static/js/bootstrap.min.js"></script>
  <script type='text/javascript' src='./static/js/knockout-3.1.0.js'></script>
  <script type='text/javascript' src='./static/js/ko.pager.js'></script>
  <script type='text/javascript' src='./static/js/sammy.js'></script>
  <script type='text/javascript' src="./static/js/coffee-script.js"></script>
  <script type='text/javascript' src='./static/js/pouchdb-3.0.6.min.js'></script>
  <script type='text/javascript' src='./static/js/knockout-bootstrap-modal-dialog.js'></script>

  <script type="text/javascript">
  $(function() {
    var db = new PouchDB('WebNfcAttendance');


    MemberViewModel = function() {
      var self = this;
      this.name = ko.observable("No Name");
      this.id = ko.observable("No NfcId");
      this.add = function() {
        self.modal.close({
          name: self.name(),
          id: self.id()
        });
      };
      this.cancel = function() {
        self.modal.close();
      }
    };

    ViewModel = function() {
      this.member_structure = [{
        name: "Name",
        field: "name"
      }, {
        name: "NfcId",
        field: "id"
      }];

      this.members = ko.observableArray([]);
      var members = this.members;

      db.allDocs({
        include_docs: true,
        descending: true
      }, function(err, doc) {
        $.each(doc.rows, function(i, v) {
          members.push(v.doc);
        })
      });

      this.addMember = function() {
        wna.showModal({
          viewModel: new MemberViewModel(),
          template: "EditMember",
          context: this
        }).then(function(result) {
          this.members.push(result);
          db.post(result, function(err, result) {
            if (!err) {
              console.log('Successfully posted a member.');
            } else {
              console.log('Error when add a member.');
              console.log(err);
            }
          });
        })
      }.bind(this);
    }

    ko.applyBindings(new ViewModel(), $('body')[0]);
  });
  </script>

</body>

</html>
